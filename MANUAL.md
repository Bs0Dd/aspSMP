# Инструкция по aspSMP

## Сборка

Для начала необходимо купить/добыть/найти сам USBasp (а точнее два, если у вас еще нет ни одного).
Их вид может отличаться, но все они имеют 10-пиновый разъем.
Стоимость модуля - около 4$ за штуку. Настоятельно советую взять их вместе со шнурком (как на фото).

![USBasp](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/usbasp.jpg)

Берем шнурок и отрезаем один конец - место отрезания выбираем на свое усмотрение.

![Assembly_0](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/asm0.jpg)

Для работы нам нужны только следующие провода. Отделяем их и зачищаем.

![Assembly_1](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/asm1.jpg)

Теперь необходимо изготовить разъем для СМП модуля. В идеале, лучше всего купить заводские соединители
(ОНп-КС-10-4/10x2,5-В21 счетверенный и ОНп-КС-10-2/5x2,5-В21 сдвоенный) и склеить их, но найти столь
экзотический продукт довольно трудно.

![ONp-KS](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/onpks.png)

Поэтому существует практически ничем не уступающее решение на основе современных и дешевых компонентов.  

Варианта сборки два, начнем с наиболее легкого:

### Легкий способ

Для этого можно закупить комплект дешевых макетных проводов Папа-Папа с разъемами Dupont/GoldPin.
Как правило сами штырьки здесь полые и легко деформируются - этим и воспользуемся.

![Novice_1](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/novi1.jpg)
![Novice_2](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/novi2.jpg)

Плоскогубцами и хорошим усилием необходимо расплющить штыри, сделав их плоскими и широкими.

![Novice_3](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/novi3.jpg)
![Novice_4](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/novi4.jpg)

Чтобы в последствии штыри не болтались в СМП и имели хороший контакт - необходимо с одной стороны (удобнее
с внутренней) покрыть их небольшим слоем свинцового припоя с помощью паяльника. Таким образом толщина штыря
станет ближе к таковой в оригинальных соединителях. После этого стоит проверить, хорошо ли получившиеся
штыри заходят в отверстия разъема СМП и не болтаются ли там.

![Novice_5](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/novi5.jpg)

Теперь остается лишь повернуть их под 90° и склеить между собой цианоакрилатным клеем (супер-клей).
Опционально добавить метку, чтобы не перепутать стороны при вставке СМП.

![Novice_6](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/novi6.jpg)

Вторую половину проводов отрезать и припаять к подготовленным проводам на шнурке USBasp.
Схема такова:

![SMP Adapter](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/smp_adapter.gif)
![Novice_7](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/novi7.jpg)

Переходник USBasp-СМП готов.

![Novice_8](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/novi8.jpg)


### Вариант для продвинутых

Можно сделать и более цивилизованный вариант шнура, если имеется опыт обжимки соединителей Dupont.
Для этого потребуется 5 пинов Dupont (Папа), 6 или 5-местный разъем и, разумеется, заготовленный шлейф от USBasp.
Единственная ремарка, что конец шлейфа в таком случае будет удобнее зачистить не сразу, а делать это с каждым
проводом по отдельности по мере обжимки, в таком случае жилы соседних проводов не будут мешаться.

![Professional_1](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/profi1.jpg)

Пять выделенных проводов необходимо обжать пинами. Обратите внимание, что при обжиме, если пины находятся внутренней
стороной наружу, то помеченный (первый) провод долен быть слева. В таком случае лицевая сторона разъема будет
соответствовать лицевой стороне модуля СМП.

![Professional_2](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/profi2.jpg)

Надеваем разъем. Важно учесть, что при использовании 6-местного разъема первый его пин (со стрелкой) должен
остаться пустым. В таком случае нумерация контактов будет соотвествовать таковой в СМП.

![Professional_3](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/profi3.jpg)

Теперь, по аналогии с первым способом, необходимо расплющить пины плоскогубцами (или иным инструментом).

![Professional_4](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/profi4.jpg)

А затем и покрыть оловом с внутренней стороны.

![Professional_5](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/profi5.jpg)

И после этого, с помощью пинцета повернуть внешнюю часть пина на 90 для соответствия ориентации пинов в СМП.

![Professional_6](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/profi6.jpg)

Если получившийся соединитель плохо заходит в СМП или, наоборот, сидит в нем недостаточно надежно -
стоит уменьшить или увеличить слой олова на пинах. Переходник USBasp-СМП готов.

![Professional_7](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/profi7.jpg)


## Прошивка

Джампер выбора напряжения на USBasp устанавливаем в 5V, далее менять его не потребуется.
Замыкаем расположенные рядом с ним (или в указанном производителем месте) штыри обновления прошивки
программатора.

![Jumpers](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/jumps.jpg)

Берем второй USBasp, где также выставляем напряжение в 5V (штыри обновления не замыкаем) и шнурком от него
соединям оба программатора.

![Two programmers](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/twoasp.jpg)

Подключаем второй программатор к компьютеру - на обоих USBasp должны загореться светодиоды LED1.

![Connected](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/conn.jpg)

Если у вас Linux - драйвера, как правило, уже встроены в систему. Достаточно убедиться в наличии устройста
командой `lsusb`.

![lsusb](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/lsusb.png)

Для Windows необходимо установить драйвер. Воспользуемся программой Zadig (включена в [комплект](https://github.com/Bs0Dd/aspSMP/releases)).
После ее открытия в списке появится устройство `USBasp`. Выберите и установите для него драйвер
`libusb-win32`.

![Zadig](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/zadig.png)

Если с драйвером возникнет проблема - попробуйте сменить его на `libusbK`.

![Driver problem](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/oops.png)

Теперь необходима программа `avrdude`. Версия для Windows прилагается к комплекту. Пользователям
Linux необходимо установить ее самостоятельно (например `sudo apt install avrdude` для Debian/Ubuntu).
Далее для прошивки можно воспользоваться либо скриптом flash(.bat/.sh), либо вручную выполнив в консоли
команду типа `avrdude -c usbasp -p m8 -U flash:w:aspsmp.hex`.

![AVRDUDE](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/avrdude.png)

Если прошивка завершилась успешно - можно отсоединить программатор от ПК и отключить от него прошитый USBasp.
С прошитого программатора снимается перемычка обновления прошивки.


## Работа

Теперь в получившийся программатор aspSMP можно вставить шнур-переходник и подключить к нему модуль СМП.
Подключаем устройство к компьютеру. Ранее установленные Zadig драйвера автоматически применятся и для aspSMP.

![aspSMP device](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/asmpdev.png)

Дальнейшая работа производится с помощью программы `aspsmp`.

![aspSMP tool](https://raw.githubusercontent.com/Bs0Dd/aspSMP/master/graphics/asptool.png)

aspSMP умеет выполнять с модулями СМП три действия: read, write, init.

* Read (чтение) - позволяет считать полный образ памяти модуля в файл.
  Например: `aspsmp read -f mpo10.bin`
* Write (запись) - позволяет записать содержимое любого файла в память модуля.
  Например: `aspsmp write -f dino.bin`
* Init (инициализация) - проводит инициализацию памяти модуля с помощью команды стирания.
  Например: `aspsmp init`

По умолчанию инициализация модуля (заполнение) производится байтом 0x20 (32), однако его можно изменить.  
Например: `aspsmp init -i 42` - заполнит СМП значением 0x2A (42).

Инициализация модуля необходима на случай если, например, при ошибочном подключениии СМП к программатору
(в таком случае поведение непредсказуемо) контроллер СМП испортит данные в ОЗУ и перейдет в режим "замка",
перестав реагировать на команды чтения (считывается 0xFF) и записи (ошибка записи).
В этом случае модуль можно разблокировать либо передачей ему команды разблокировки с кодовым словом
(первые 8 байт в ОЗУ), на что дается три попытки. Либо проинциализировать память СМП, заполнив его, начиная
с адреса 0xFFFF (обязательное требование, несмотря на меньший фактический размер), произвольным байтом
с помощью команды стирания.  
Аналогичный эффект можно получить с помощью команды `INIT` в БЕЙСИКе МК90.

Если при чтении СМП образ памяти состоит из нулей (хотя СМП не пуст), вероятно, между СМП и aspSMP нет
удовлетворительного контакта. Стоит проверить изготовленный шнур.

На этом все!

---

Составление инструкции:  
2026 © Bs0Dd [[bs0dd.net]](http://bs0dd.net)
